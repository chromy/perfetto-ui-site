{"version":3,"file":"processor_bundle.js","sources":["../../../ui/src/processor.ts","../../../ui/src/trace_processor/index.ts"],"sourcesContent":["/*\n * Copyright (C) 2018 The Android Open Source Project\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { main } from './trace_processor';\n\nmain();\n\n","/*\n * Copyright (C) 2018 The Android Open Source Project\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nclass TraceProcessorBridge {\n  wasm_?: any = undefined;\n  file_?: File = undefined;\n  // @ts-ignore\n  fileReader = new FileReaderSync();\n\n  constructor() {\n  }\n\n  get file(): File {\n    console.assert(this.file_);\n    if (!this.file_)\n      throw \"Error!\";\n    return this.file_;\n  }\n\n  set file(f: File) {\n    console.assert(!this.file_);\n    this.file_ = f;\n    this.maybeInitialize();\n  }\n\n  onRuntimeInitialized(wasm: any) {\n    console.assert(!this.wasm_);\n    this.wasm_ = wasm;\n    this.maybeInitialize();\n  }\n\n  maybeInitialize() {\n    console.log('maybeInitialize', this.wasm_, this.file_);\n    if (!this.wasm_ || !this.file_)\n      return;\n    const readTraceFn = this.wasm_.addFunction(this.readTraceData.bind(this), 'iiii');\n    const replyFn = this.wasm_.addFunction(this.reply.bind(this), 'viiii');\n    this.wasm_.ccall('Initialize', 'void',\n      ['number', 'number'],\n      [readTraceFn, replyFn]);\n  }\n\n  readTraceData(offset: number, len: number, dstPtr: number): number {\n    const slice = this.file.slice(offset, offset + len);\n    const buf: ArrayBuffer = this.fileReader.readAsArrayBuffer(slice);\n    const buf8 = new Uint8Array(buf);\n    this.wasm_.HEAPU8.set(buf8, dstPtr);\n    return buf.byteLength;\n  }\n\n  reply(reqId: number, success: boolean, heapPtr: number, size: number) {\n    const data = this.wasm_.HEAPU8.slice(heapPtr, heapPtr + size);\n    console.log('reply', reqId, success, data);\n  }\n\n  query() {\n    this.wasm_.ccall('ExecuteQuery', 'void', [], []);\n  }\n}\n\nfunction main() {\n  console.log('Hello from processor!');\n\n  const bridge = new TraceProcessorBridge();\n\n  (self as any).onmessage = (msg: any) => {\n    switch (msg.data.topic) {\n      case \"load_file\":\n        const file = msg.data.file;\n        bridge.file = file;\n        break;\n      case \"query\":\n        bridge.query();\n        break\n    }\n  };\n\n  (self as any).Module = {\n    locateFile: (s: any) => {\n      const parts = location.pathname.split('/');\n      const base = parts.splice(0, parts.length-1).join('/');\n      const path = `${base}/${s}`\n      console.log('locateFile', s, base, path);\n      return path;\n    },\n    onRuntimeInitialized: () => bridge.onRuntimeInitialized((self as any).Module),\n    print: (s: string) => console.log(s),\n    printErr: (s: string) => console.warn(s), \n  };\n\n  (self as any).importScripts('trace_processor.js');\n}\n\nexport {\n  main,\n}\n"],"names":["trace_processor_1"],"mappings":"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"}